<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

The `xmalloc.h` file in the `spam-detection` codebase provides custom memory allocation functions that ensure successful allocation by checking results and handling errors.

# Purpose
This C header file, `xmalloc.h`, provides declarations for a set of memory management and string manipulation functions that enhance standard C library functions by incorporating error checking and handling. The functions, such as [`xmalloc`](<#xmalloc>), [`xcalloc`](<#xcalloc>), [`xrealloc`](<#xrealloc>), and [`xstrdup`](<#xstrdup>), are designed to never return a failure; instead, they invoke a fatal error handler if an error occurs, ensuring robust memory allocation. Additionally, the file includes safer versions of formatted output functions like [`xasprintf`](<#xasprintf>) and [`xsnprintf`](<#xsnprintf>), which include format string checking and non-null attribute specifications to prevent common errors. This header is part of a larger software project, likely related to secure shell (SSH) development, as indicated by the author's note on usage and compatibility with protocol descriptions.
# Function Declarations (Public API)

---
### xmalloc<!-- {{#callable_declaration:xmalloc}} -->
Allocates memory and ensures allocation success.
- **Description**: This function allocates a block of memory of the specified size and guarantees that the allocation is successful. It should be used when you need to allocate memory and want to ensure that the program will not continue with a null pointer in case of allocation failure. If the requested size is zero or if the allocation fails, the function will terminate the program with an error message. This function is suitable for use in environments where memory allocation failures are considered fatal and should be handled by terminating the program.
- **Inputs**:
    - `size`: The number of bytes to allocate. Must be greater than zero. If zero is passed, the function will terminate the program with an error message.
- **Output**: A pointer to the allocated memory block, which is guaranteed to be non-null.
- **See also**: [`xmalloc`](<xmalloc.c.md#xmalloc>)  (Implementation)


---
### xcalloc<!-- {{#callable_declaration:xcalloc}} -->
Allocates and zeroes memory for an array.
- **Description**: This function allocates memory for an array of `nmemb` elements, each of `size` bytes, and initializes all bytes in the allocated storage to zero. It is intended for use when you need a block of memory that is guaranteed to be initialized to zero. The function will terminate the program if either `nmemb` or `size` is zero, or if the memory allocation fails, ensuring that it never returns a null pointer. This behavior makes it suitable for use in programs where memory allocation failures are considered fatal errors.
- **Inputs**:
    - `nmemb`: The number of elements to allocate. Must be greater than zero. If zero, the function will terminate the program.
    - `size`: The size of each element in bytes. Must be greater than zero. If zero, the function will terminate the program.
- **Output**: A pointer to the allocated memory, which is initialized to zero. The program will terminate if allocation fails.
- **See also**: [`xcalloc`](<xmalloc.c.md#xcalloc>)  (Implementation)


---
### xrealloc<!-- {{#callable_declaration:xrealloc}} -->
Reallocates memory to a new size, ensuring success or terminating the program.
- **Description**: This function is used to resize a previously allocated memory block to a new size. It guarantees that the reallocation will succeed by terminating the program if an error occurs, thus it never returns a null pointer. This function is useful in scenarios where memory allocation failures are critical and cannot be tolerated. It should be used when you need to change the size of an existing memory allocation and want to ensure that the operation is always successful.
- **Inputs**:
    - `ptr`: A pointer to the memory block to be reallocated. This pointer must have been previously allocated by a compatible memory allocation function (e.g., xmalloc, xcalloc, xrealloc). It can be null, in which case the function behaves like xmalloc.
    - `size`: The new size for the memory block in bytes. It must be a positive value. If the size is zero, the behavior is implementation-defined, but typically it frees the memory block.
- **Output**: A pointer to the reallocated memory block, which is guaranteed to be non-null.
- **See also**: [`xrealloc`](<xmalloc.c.md#xrealloc>)  (Implementation)


---
### xreallocarray<!-- {{#callable_declaration:xreallocarray}} -->
Reallocates memory for an array with error checking.
- **Description**: This function reallocates memory for an array, ensuring that the allocation is successful. It is used when you need to resize an existing memory block pointed to by `ptr` to accommodate `nmemb` elements, each of size `size`. The function will terminate the program if the allocation fails or if either `nmemb` or `size` is zero, ensuring that the caller does not need to handle these errors. This function is suitable for use in applications where memory allocation failures are considered fatal and should be avoided in contexts where such failures need to be handled gracefully.
- **Inputs**:
    - `ptr`: A pointer to the memory block to be reallocated. It can be NULL, in which case the function behaves like `xmalloc` for a new allocation. The caller retains ownership.
    - `nmemb`: The number of elements to allocate. Must be greater than zero; otherwise, the function will terminate the program.
    - `size`: The size of each element to allocate. Must be greater than zero; otherwise, the function will terminate the program.
- **Output**: Returns a pointer to the newly allocated memory block. The program terminates if the allocation fails.
- **See also**: [`xreallocarray`](<xmalloc.c.md#xreallocarray>)  (Implementation)


---
### xrecallocarray<!-- {{#callable_declaration:xrecallocarray}} -->
Reallocate and zero-initialize an array with error checking.
- **Description**: This function reallocates an array to a new size, ensuring that any newly allocated memory is zero-initialized. It is designed to handle memory allocation errors by terminating the program if the allocation fails or if invalid parameters are provided. This function should be used when you need to resize an array and want to ensure that any new memory is zeroed out, while also ensuring that the program does not continue execution in the event of a memory allocation failure. It is important to note that this function will terminate the program if either the number of elements or the size of each element is zero.
- **Inputs**:
    - `ptr`: A pointer to the existing memory block to be reallocated. This can be NULL, in which case the function behaves like a zero-initialized allocation.
    - `oldnmemb`: The number of elements in the existing memory block. Must be a valid size_t value.
    - `nmemb`: The new number of elements for the memory block. Must be greater than zero; otherwise, the program will terminate.
    - `size`: The size of each element in bytes. Must be greater than zero; otherwise, the program will terminate.
- **Output**: Returns a pointer to the newly allocated and zero-initialized memory block. The program terminates if allocation fails.
- **See also**: [`xrecallocarray`](<xmalloc.c.md#xrecallocarray>)  (Implementation)


---
### xstrdup<!-- {{#callable_declaration:xstrdup}} -->
Duplicates a string with error handling.
- **Description**: This function creates a duplicate of the given string, ensuring that memory allocation is successful. It is used when a copy of a string is needed and the program cannot proceed if memory allocation fails. The function will terminate the program with an error message if it cannot allocate the necessary memory, making it suitable for use in applications where such failures are considered fatal. It should be called with a valid, null-terminated string.
- **Inputs**:
    - `str`: A pointer to a null-terminated string that is to be duplicated. Must not be null, as the function does not handle null pointers and will result in undefined behavior if passed a null value.
- **Output**: A pointer to the newly allocated duplicate of the input string. The caller is responsible for freeing this memory when it is no longer needed.
- **See also**: [`xstrdup`](<xmalloc.c.md#xstrdup>)  (Implementation)


---
### xstrndup<!-- {{#callable_declaration:xstrndup}} -->
Duplicates a string up to a specified maximum length, ensuring memory allocation success.
- **Description**: This function creates a duplicate of the input string, copying at most 'maxlen' characters, and ensures that the memory allocation for the new string is successful. It is useful when you need a copy of a string with a limited length, and you want to ensure that the program terminates with an error message if memory allocation fails. The function should be used when the caller needs a new, independent copy of a string segment, and it is critical that the program does not continue execution if memory allocation fails. The caller is responsible for freeing the returned string when it is no longer needed.
- **Inputs**:
    - `str`: The input string to be duplicated. Must not be null. The function will attempt to duplicate up to 'maxlen' characters from this string.
    - `maxlen`: The maximum number of characters to duplicate from 'str'. Must be a non-negative value. If 'maxlen' is greater than the length of 'str', the entire string is duplicated.
- **Output**: A pointer to the newly allocated string containing up to 'maxlen' characters from 'str'. The function will not return on memory allocation failure, as it will terminate the program with an error message.
- **See also**: [`xstrndup`](<xmalloc.c.md#xstrndup>)  (Implementation)


---
### xasprintf<!-- {{#callable_declaration:xasprintf}} -->
Formats a string and allocates memory for it.
- **Description**: This function formats a string according to the specified format string and additional arguments, allocating memory to store the resulting string. It is useful when you need a formatted string but do not know the required buffer size in advance. The function ensures that memory allocation is successful, and it will not return a failure. The caller is responsible for freeing the allocated memory to avoid memory leaks. This function must be called with a valid format string, and the format string must not be null.
- **Inputs**:
    - `ret`: A pointer to a char pointer where the address of the allocated string will be stored. Must not be null. The caller is responsible for freeing the allocated memory.
    - `fmt`: A format string as in printf. Must not be null. Specifies how the subsequent arguments are converted for output.
    - `...`: Additional arguments to be formatted according to the format string. The number and types of these arguments must match the format specifiers in the format string.
- **Output**: Returns the number of characters printed, excluding the null byte used to end output to strings.
- **See also**: [`xasprintf`](<xmalloc.c.md#xasprintf>)  (Implementation)


---
### xvasprintf<!-- {{#callable_declaration:xvasprintf}} -->
Formats a string and allocates memory for it, ensuring successful allocation.
- **Description**: This function formats a string according to the specified format and arguments, allocating memory for the resulting string. It is used when you need to create a formatted string with dynamic content, and it ensures that memory allocation is successful by terminating the program if an error occurs. This function should be used when you want to avoid handling memory allocation failures manually. The function must be called with a valid format string, and the caller is responsible for freeing the allocated memory.
- **Inputs**:
    - `ret`: A pointer to a char pointer where the address of the allocated string will be stored. Must not be null. The caller is responsible for freeing the allocated memory.
    - `fmt`: A format string that specifies how to format the output. Must not be null.
    - `ap`: A va_list of arguments to be formatted according to the format string. Must be properly initialized before calling this function.
- **Output**: Returns the number of characters printed (excluding the null byte) or terminates the program if memory allocation fails.
- **See also**: [`xvasprintf`](<xmalloc.c.md#xvasprintf>)  (Implementation)


---
### xsnprintf<!-- {{#callable_declaration:xsnprintf}} -->
Formats a string and stores it in a buffer.
- **Description**: This function formats a string according to the specified format string and stores the result in the provided buffer. It is similar to snprintf but includes additional safety checks. The function must be called with a valid format string and a buffer that is large enough to hold the resulting formatted string, including the null terminator. The function ensures that the buffer is not overflowed by limiting the number of characters written based on the specified buffer length. It is important to ensure that the format string is not null, as this will lead to undefined behavior.
- **Inputs**:
    - `str`: A pointer to the buffer where the formatted string will be stored. The buffer must be large enough to hold the resulting string, including the null terminator. The caller retains ownership and must ensure it is not null.
    - `len`: The size of the buffer pointed to by str. It defines the maximum number of characters to be written, including the null terminator.
    - `fmt`: A format string that specifies how to format the data. It must not be null, and it follows the same specifications as the format string in printf.
- **Output**: Returns the number of characters that would have been written if the buffer had been large enough, not counting the null terminator. If the return value is greater than or equal to len, the output was truncated.
- **See also**: [`xsnprintf`](<xmalloc.c.md#xsnprintf>)  (Implementation)


---
### xvsnprintf<!-- {{#callable_declaration:xvsnprintf}} -->
Formats a string into a buffer using a variable argument list.
- **Description**: This function formats a string according to a specified format and stores the result in a provided buffer. It is used when you have a variable argument list that needs to be formatted into a string. The function ensures that the formatted string does not exceed the specified buffer length, and it will terminate the program if the buffer length exceeds INT_MAX or if the formatted string would overflow the buffer. This function is useful in scenarios where you need a safe and bounded string formatting operation.
- **Inputs**:
    - `str`: A pointer to the buffer where the formatted string will be stored. The buffer must be large enough to hold the formatted string, including the null terminator. The caller retains ownership and must ensure it is not null.
    - `len`: The maximum number of bytes to write to the buffer, including the null terminator. Must not exceed INT_MAX. If len is greater than INT_MAX, the function will terminate the program.
    - `fmt`: A format string that specifies how to format the variable argument list. Must not be null.
    - `ap`: A variable argument list that contains the data to be formatted according to the format string. The caller is responsible for initializing and managing the lifecycle of this argument list.
- **Output**: Returns the number of characters that would have been written if len had been sufficiently large, not counting the terminating null character. If the return value is negative or greater than or equal to len, the function will terminate the program.
- **See also**: [`xvsnprintf`](<xmalloc.c.md#xvsnprintf>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)