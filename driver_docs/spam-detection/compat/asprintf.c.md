<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements `asprintf` and `vasprintf` functions for formatted string allocation.

# Purpose
This code provides implementations for the [`asprintf`](<#asprintf>) and [`vasprintf`](<#vasprintf>) functions, which are used to format strings and allocate memory for them dynamically. The [`asprintf`](<#asprintf>) function takes a format string and a variable number of arguments, formats the string, and stores the result in a dynamically allocated buffer. It uses [`vasprintf`](<#vasprintf>) internally, which performs the same operation but takes a `va_list` argument for handling the variable arguments. The [`vasprintf`](<#vasprintf>) function first calculates the required buffer size using `vsnprintf`, then allocates memory using `xcalloc`, and finally formats the string into the allocated buffer. If an error occurs during formatting, the functions ensure that the allocated memory is freed and return `-1`. The code includes necessary headers and relies on external functions `xcalloc` and `free` for memory management.
# Imports and Dependencies

---
- `sys/types.h`
- `stdarg.h`
- `stdio.h`
- `string.h`
- `stdlib.h`
- `compat.h`
- `xmalloc.h`


# Functions

---
### asprintf<!-- {{#callable:asprintf}} -->
Formats a string and allocates memory for it, storing the result in a pointer.
- **Inputs**:
    - ``ret``: A pointer to a character pointer where the function will store the address of the allocated formatted string.
    - ``fmt``: A format string that specifies how to format the subsequent arguments.
    - ``...``: A variable number of arguments that are formatted according to the format string `fmt`.
- **Logic and Control Flow**:
    - Initialize a `va_list` variable `ap` to handle the variable arguments.
    - Call [`vasprintf`](<#vasprintf>) with `ret`, `fmt`, and `ap` to perform the actual string formatting and memory allocation.
    - End the use of the `va_list` variable `ap` with `va_end`.
    - Return the result of [`vasprintf`](<#vasprintf>), which is the number of characters printed or a negative value if an error occurs.
- **Output**: Returns the number of characters printed (excluding the null byte) or a negative value if an error occurs.
- **Functions Called**:
    - [`vasprintf`](<#vasprintf>)


---
### vasprintf<!-- {{#callable:vasprintf}} -->
Formats a string and allocates memory for it, storing the result in a dynamically allocated buffer.
- **Inputs**:
    - `ret`: A pointer to a character pointer where the function will store the address of the allocated buffer containing the formatted string.
    - `fmt`: A format string that specifies how to format the data.
    - `ap`: A `va_list` object that contains the variable arguments to format according to `fmt`.
- **Logic and Control Flow**:
    - Copies the `va_list` `ap` to `ap2` to preserve the original list for reuse.
    - Calls `vsnprintf` with a `NULL` buffer to calculate the size needed for the formatted string.
    - If `vsnprintf` returns a negative value, indicating an error, it jumps to the `error` label.
    - Allocates memory for the formatted string using [`xcalloc`](<../xmalloc.c.md#xcalloc>), which initializes the memory to zero.
    - Calls `vsnprintf` again to format the string into the allocated buffer.
    - If the second `vsnprintf` call fails, frees the allocated memory and jumps to the `error` label.
    - Ends the use of `va_list` `ap2` with `va_end`.
    - Returns the number of characters written, excluding the null terminator, or -1 if an error occurred.
- **Output**: Returns the number of characters written to the allocated buffer, excluding the null terminator, or -1 if an error occurs.
- **Functions Called**:
    - [`xcalloc`](<../xmalloc.c.md#xcalloc>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)